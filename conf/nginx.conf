 # worker_processes  1;
# error_log  logs/error.log;

# events {
	# worker_connections  1024;
	# }

# http {

    # keepalive_timeout	60;
    # send_timeout        10;
    # keepalive_requests  10;
    # client_body_timeout 10;

    # #gzip		on;
    # sendfile		on;
    # include		mime.types;
    # default_type	application/octet-stream;

    # log_format	main  '$remote_addr - $remote_user [$time_local] "$request" '
	                  # '$status $body_bytes_sent "$http_referer" '
	                  # '"$http_user_agent" "$http_x_forwarded_for"';
    # access_log	logs/access.log  main;

	# server {

	# listen		80;
	# # listen [::]:	80 ipv6only;

	# server_name	localhost;
	# access_log	logs/host.access.log  main;
	# add_header	Strict-Transport-Security "max-age=63072000;";
	# index index.php index-nginx.html index.html index.htm;

        # error_page   500 502 503 504  /50x.html;
		# location = /50x.html {
		# root   site;
		# }

        # # location ~ \.php$ {
	# #	include        fastcgi_params;
	# #	fastcgi_pass   127.0.0.1:9000;
	# #	fastcgi_index  index.php;
	# #	fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
	# #	}
	
	# location / {
		# location ~* \.m3u8$ {
		# add_header cache-control no-cache;
		# }
		# try_files $uri $uri/ =404;
		# add_header 'access-control-allow-origin' '*' always;
		# add_header 'strict-transport-security' 'max-age=31536000';
		# add_header 'x-content-type-options' "nosniff" 'always';
		# if ($request_method = 'options') {
		# add_header 'access-control-allow-methods' 'get, post, options';
		# add_header 'access-control-allow-headers' 'dnt,user-agent,x-requested-with,if-modified-since,cache-control,content-type,range';
		# add_header 'access-control-max-age' 1728000;
		# # add_header 'content-type' 'text/plain; charset=utf-8';
		# add_header 'content-length' 0;
		# return 204;
		# }
		# if ($request_method = 'post') {
		# add_header 'access-control-allow-origin' '*' always;
		# add_header 'access-control-allow-methods' 'get, post, options';
		# add_header 'access-control-allow-headers' 'dnt,user-agent,x-requested-with,if-modified-since,cache-control,content-type,range';
		# add_header 'access-control-expose-headers' 'content-length';
		# }
		# if ($request_method = 'get') {
		# add_header 'access-control-allow-origin' '*' always;
		# add_header 'access-control-allow-methods' 'get, post, options';
		# add_header 'access-control-allow-headers' 'dnt,user-agent,x-requested-with,if-modified-since,cache-control,content-type,range';
		# add_header 'access-control-expose-headers' 'content-length,content-range';
		# }

		# root site;
		# index index.php index.html index-nginx.html index.htm index.m3u8 index.mpd;
		# }
		
		
		# # types {
			# # application/dash+xml mpd;
			# # application/vnd.apple.mpegurl m3u8;
			# # video/mp2t ts;
			# # video/mp4 mp4;
			# # text/html html;
			# # }
		# # location / {
		# # root /tmp/hls;

		# # }
		
		
        # location /stat {
		# rtmp_stat all;
		# rtmp_stat_stylesheet stat.xsl;
		# # auth_basic "Restricted Content";
		# # auth_basic_user_file .htpasswd;
		# }

        # location /stat.xsl {
		# root site;
		# }

        # #location /control {
		# #rtmp_control all;
		# # auth_basic "stream";
		# # auth_basic_user_file .htpasswd;
		# #}

        # #location /publish {
        # #    return 201;
        # #}
        # #location /play {
        # #    return 202;
        # #}
        # #location /record_done {
        # #    return 203;
        # #}
		
	# location /tmp_hls {
	    # if ($request_method = 'OPTIONS') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Max-Age' 1728000;
		# add_header 'Content-Type' 'text/plain; charset=utf-8';
		# add_header 'Content-Length' 0;
		# return 204;
		# }
		# if ($request_method = 'POST') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
		# if ($request_method = 'GET') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
		# types {
		# application/vnd.apple.mpegurl m3u8;
		# text/html html;
		# }
		# autoindex on;
		# autoindex_localtime on;
		# autoindex_exact_size off;
		# alias tmp/hls;							# <----- 
		# expires -1;
		# }

	# location /tmp_dash {
		# alias tmp/dash;							# <----- 
		# autoindex on;
		# autoindex_localtime on;
		# autoindex_exact_size off;
		# expires -1;

	    # if ($request_method = 'OPTIONS') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Max-Age' 1728000;
		# add_header 'Content-Type' 'text/plain; charset=utf-8';
		# add_header 'Content-Length' 0;
		# return 204;
		# }
		# if ($request_method = 'POST') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
		# if ($request_method = 'GET') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
	# types {
		# application/dash+xml mpd;
		# application/vnd.apple.mpegurl m3u8;
		# video/mp2t ts;
		# text/html html;
		# }
	# }

	# location /recordings {
		# alias recordings;  
		# autoindex on;
		# autoindex_localtime on;
		# autoindex_exact_size off;
		# expires -1;

		# if ($request_method = 'OPTIONS') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Max-Age' 1728000;
		# add_header 'Content-Type' 'text/plain; charset=utf-8';
		# add_header 'Content-Length' 0;
		# return 204;
		# }
		# if ($request_method = 'POST') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
		# if ($request_method = 'GET') {
		# add_header 'Access-Control-Allow-Origin' '*' always;
		# add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
		# add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
		# add_header 'Access-Control-Expose-Headers' 'Content-Length';
		# }
		# types {
			# application/dash+xml mpd;
			# application/vnd.apple.mpegurl m3u8;
			# video/mp2t ts;
			# video/mp4 mp4;
			# text/html html;
			# }
		# }
	# }
	

# }

# rtmp {
    # server {
	# listen 1935;

	# application live {
	    # live on;
		# interleave on;
		# meta on;
		# session_relay on;
		# max_connections 1500;
	    # record_path recordings;
		# record_suffix all-%d-%b-%y-%T.flv;
		# # record_interval 30s;
		# # record keyframes;

		# push rtmp://localhost/hls;
		# push rtmp://localhost/dash;
		# # push rtmp://localhost/youtube

		# # exec ffmpeg -i rtmp://localhost/$app/$name  -async 1 -vsync -1 
		# #-c:v libx264 -acodec copy -b:v 256k -vf "scale=480:trunc(ow/a/2)*2" -tune zerolatency -preset veryfast -crf 23 -g 60 -hls_list_size 0 -f flv rtmp://localhost/hls/$name_low
		# #-c:v libx264 -acodec copy -b:v 768k -vf "scale=720:trunc(ow/a/2)*2" -tune zerolatency -preset veryfast -crf 23 -g 60 -hls_list_size 0 -f flv rtmp://localhost/hls/$name_mid
		# #-c:v libx264 -acodec copy -b:v 1024k -vf "scale=960:trunc(ow/a/2)*2" -tune zerolatency -preset veryfast -crf 23 -g 60 -hls_list_size 0 -f flv rtmp://localhost/hls/$name_high
		# #-c:v libx264 -acodec copy -b:v 1920k -vf "scale=1280:trunc(ow/a/2)*2" -tune zerolatency -preset veryfast -crf 23 -g 60 -hls_list_size 0 -f flv rtmp://localhost/hls/$name_higher
		# #-c copy -f flv rtmp://localhost/hls/$name_src;
		
		
		# # hls on;
		# # hls_fragment 10s;
		# # hls_path tmp/hls;
		# # dash on;
		# # dash_fragment 10s;
		# # dash_path tmp/dash;
		# }
	
	# application hls {
	    # live on;
		# hls on;
		# hls_nested on;
		# hls_cleanup on;
		# meta copy;
		# # hls_sync 100ms;
		# hls_type live;
		# hls_fragment 10s;
		# hls_playlist_length 30s;
		# hls_path tmp/hls;						# <----- 
		# hls_fragment_naming system;

		# hls_variant _low BANDWIDTH=288000;	# Low bitrate, sub-SD resolution
		# hls_variant _mid BANDWIDTH=448000;	# Medium bitrate, SD resolution
		# hls_variant _high BANDWIDTH=1152000;	# Higher-than-SD resolution 
		# hls_variant _higher BANDWIDTH=2048000;	# High bitrate, HD 720p resolution
		# hls_variant _src BANDWIDTH=4096000;	# Source bitrate, source resolution
		# }

	# application dash {
	    # live on;
		# dash on;
		# dash_nested on;
		# dash_cleanup on;
		# dash_fragment 10s;
		# dash_playlist_length 30s;
		# dash_path tmp/dash;						# <----- 
		# }

	# #application youtube {
	        # #live on;
	        # #push rtmp://a.rtmp.youtube.com/live2/YOUR_STREAM_KEY;
		# #allow publish 127.0.0.1;
		# #deny publish all;
		# #}
	# }
# }


# # ######################################### linux-server code

# # #user  nobody;
# # worker_processes  1;

# # #error_log  logs/error.log;
# # #error_log  logs/error.log  notice;
# # #error_log  logs/error.log  info;

# # #pid        logs/nginx.pid;


# # events {
    # # worker_connections  1024;
# # }

# # rtmp { 
    # # server { 
        # # listen 1935; 
        # # application live { 
            # # live on; 
            # # interleave on;
             # # hls on; 
            # # hls_path tmp/hls; 
            # # hls_fragment 15s; 
            # # dash on; 
            # # dash_path tmp/dash; 
            # # dash_fragment 15s; 
            # # #pull rtmp://tv2.example.com:443/root/new name=tv2 static;
        # # } 
# # #        application hls { 
# # #           hls on; 
# # #           hls_path /tmp/hls; 
# # #           hls_fragment 15s; 
# # #       } 
# # #       
# # #       application dash { 
# # #           dash on; 
# # #           dash_path /tmp/dash; 
# # #           dash_fragment 15s; 
# # #       } 
   # # }
# # } 
 

# # http {
    # # include       mime.types;
    # # default_type  application/octet-stream;

    # # #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    # # #                  '$status $body_bytes_sent "$http_referer" '
    # # #                  '"$http_user_agent" "$http_x_forwarded_for"';

    # # #access_log  logs/access.log  main;

    # # sendfile        on;
    # # #tcp_nopush     on;

    # # #keepalive_timeout  0;
    # # keepalive_timeout  65;

    # # #gzip  on;

   # # types {
      # # # text/html html;
      # # application/dash+xml mpd;
      # # # application/vnd.apple.mpegurl m3u8;
      # # # video/mp2t ts;
       # # # text/html html;
    # # } 

    # # server {
        # # listen       80;
        # # server_name  localhost;

        # # #charset koi8-r;

        # # #access_log  logs/host.access.log  main;

        # # location / {
            # # root   tmp/hls;
        # # }
        # # #location /tv { 
        # # #    root /tmp/hls; 
        # # #}
        # # location /livehls/ {
            # # root    tmp/hls;
        # # }

        # # #error_page  404              /404.html;

        # # # redirect server error pages to the static page /50x.html
        # # #
        # # error_page   500 502 503 504  /50x.html;
        # # location = /50x.html {
            # # root   html;
        # # }

        # # # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        # # #
        # # #location ~ \.php$ {
        # # #    proxy_pass   http://127.0.0.1;
        # # #}

        # # # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        # # #
        # # #location ~ \.php$ {
        # # #    root           html;
        # # #    fastcgi_pass   127.0.0.1:9000;
        # # #    fastcgi_index  index.php;
        # # #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        # # #    include        fastcgi_params;
        # # #}

        # # # deny access to .htaccess files, if Apache's document root
        # # # concurs with nginx's one
        # # #
        # # #location ~ /\.ht {
        # # #    deny  all;
        # # #}
    # # }


    # # # another virtual host using mix of IP-, name-, and port-based configuration
    # # #
    # # #server {
    # # #    listen       8000;
    # # #    listen       somename:8080;
    # # #    server_name  somename  alias  another.alias;

    # # #    location / {
    # # #        root   html;
    # # #        index  index.html index.htm;
    # # #    }
    # # #}


    # # # HTTPS server
    # # #
    # # #server {
    # # #    listen       443 ssl;
    # # #    server_name  localhost;

    # # #    ssl_certificate      cert.pem;
    # # #    ssl_certificate_key  cert.key;

    # # #    ssl_session_cache    shared:SSL:1m;
    # # #    ssl_session_timeout  5m;

    # # #    ssl_ciphers  HIGH:!aNULL:!MD5;
    # # #    ssl_prefer_server_ciphers  on;

    # # #    location / {
    # # #        root   html;
    # # #        index  index.html index.htm;
    # # #    }
    # # #}

# # }


############################### https://github.com/illuspas/nginx-rtmp-win32


worker_processes  1;

error_log  logs/error.log info;

events {
    worker_connections  1024;
}

rtmp {
    server {
        listen 1935;

        application live {
            live on; 
            interleave on;
			
			push rtmp://localhost/hls;
			# push rtmp://localhost/dash;
			
            # hls on; 
            # hls_path tmp/hls; 
            # hls_fragment 15s; 
            # dash on; 
            # dash_path tmp/dash; 
            # dash_fragment 15s; 
            #pull rtmp://tv2.example.com:443/root/new name=tv2 static; 
			

        }
		
		application hls {
            live on;
            hls on;  
            hls_path tmp/hls;  
            hls_fragment 15s;  
		}
	}
}

http {
    server {
        listen      9080;
		
        location / {
            root html;
        }
		
        location /stat {
            rtmp_stat all;
            rtmp_stat_stylesheet stat.xsl;
        }

        location /stat.xsl {
            root html;
        }
		
        location /hls {  
            #server hls fragments  
            types{  
                application/vnd.apple.mpegurl m3u8;  
                video/mp2t ts;  
            }  
            alias tmp/hls;  
            expires -1;  
        }  
    }
}